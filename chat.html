<html>
<head>
  <meta charset="utf-8">
  <title>オンライン掲示板</title>
  <style>
    body {
      background-color: #f0e0d6;
      font-family: "メイリオ", Meiryo, sans-serif;
    }
    h1 {
      text-align: center;
      color: #800000;
    }
    #thread {
      width: 80%;
      margin: 0 auto;
      border: 1px solid #800000;
    }
    .post {
      padding: 10px;
      border-bottom: 1px dashed #800000;
    }
    .post-number {
      color: #800000;
      font-weight: bold;
    }
    .post-name {
      color: #008000;
      font-weight: bold;
    }
    .post-date {
      color: #808080;
    }
    .post-content {
      margin-top: 10px;
      white-space: pre-wrap;
    }
    #form {
      width: 80%;
      margin: 20px auto;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #form input, #form textarea {
      width: 80%;
      margin-bottom: 10px;
    }
    #form button {
      width: 20%;
      height: 40px;
      background-color: #800000;
      color: white;
      font-weight: bold;
      border: none;
    }
  </style>
</head>
<body>
  <h1>オンライン掲示板</h1>
  <div id="thread"></div>
  <div id="form">
    <input type="text" id="name" placeholder="名前" value="名無しさん">
    <textarea id="content" placeholder="内容" rows="5"></textarea>
    <button id="submit">書き込む</button>
  </div>
  <script>
    // 掲示板のデータを保存するためのgithubのリポジトリのURLを設定する
    // リポジトリは事前に作成しておく必要がある
    // リポジトリはpublicにすること
    // リポジトリにはdata.jsonという名前の空のファイルを作成しておくこと
    // リポジトリにはPersonal access tokenを使ってアクセスすること
    // Personal access tokenは事前に生成しておく必要がある
    // Personal access tokenはrepoスコープを持つ必要がある
    // Personal access tokenは安全に保管すること
    const repoUrl = "https://api.github.com/repos/your-username/your-repo-name/contents/data.json";
    const token = "your-personal-access-token";

    // 掲示板のデータを取得する関数
    async function getData() {
      // githubのAPIを使ってdata.jsonファイルを取得する
      let response = await fetch(repoUrl, {
        method: "GET",
        headers: {
          "Authorization": "token " + token
        }
      });
      // レスポンスが正常ならば
      if (response.ok) {
        // レスポンスをJSON形式で解析する
        let data = await response.json();
        // data.jsonファイルの内容をBase64でデコードする
        let content = atob(data.content);
        // デコードした内容をJSON形式で解析する
        let posts = JSON.parse(content);
        // 掲示板のデータを返す
        return posts;
      } else {
        // レスポンスが正常でなければエラーを投げる
        throw new Error("データの取得に失敗しました: " + response.status);
      }
    }

    // 掲示板のデータを更新する関数
    async function updateData(posts) {
      // 掲示板のデータをJSON形式で文字列化する
      let content = JSON.stringify(posts);
      // 文字列化した内容をBase64でエンコードする
      let encoded = btoa(content);
      // githubのAPIを使ってdata.jsonファイルを更新するためのパラメータを作成する
      let params = {
        message: "update data",
        content: encoded
      };
      // githubのAPIを使ってdata.jsonファイルを更新する
      let response = await fetch(repoUrl, {
        method: "PUT",
        headers: {
          "Authorization": "token " + token
        },
        body: JSON.stringify(params)
      });
      // レスポンスが正常ならば
      if (response.ok) {
        // レスポンスをJSON形式で解析する
        let data = await response.json();
        // 更新されたdata.jsonファイルのURLを返す
        return data.content.url;
      } else {
        // レスポンスが正常でなければエラーを投げる
        throw new Error("データの更新に失敗しました: " + response.status);
      }
    }

    // 掲示板に投稿する関数
    async function post() {
      // 入力された名前と内容を取得する
      let name = document.getElementById("name").value;
      let content = document.getElementById("content").value;
      // 名前と内容が空でなければ
      if (name && content) {
        try {
          // 掲示板のデータを取得する
          let posts = await getData();
          // 新しい投稿を作成する
          let post = {
            number: posts.length + 1, // 投稿番号はデータの長さに1を足したもの
            name: name, // 投稿者の名前は入力された名前
            date: new Date().toLocaleString(), // 投稿日時は現在の日時
            content: content // 投稿内容は入力された内容
          };
          // 掲示板のデータに新しい投稿を追加する
          posts.push(post);
          // 掲示板のデータを更新する
          await updateData(posts);
          // 入力欄を空にする
          document.getElementById("content").value = "";
          // 掲示板を表示する
          show();
        } catch (error) {
          // エラーが発生したらアラートで表示する
          alert(error.message);
        }
      }
    }

    // 掲示板を表示する関数
    async function show() {
      try {
        // 掲示板のデータを取得する
        let posts = await getData();
        // 掲示板の要素を取得する
        let thread = document.getElementById("thread");
        // 掲示板の要素の中身を空にする
        thread.innerHTML = "";
        // 掲示板のデータに含まれる投稿ごとに繰り返す
        for (let post of posts) {
          // 投稿を表示するための要素を作成する
          let div = document.createElement("div");
          div.className = "post";
          div.innerHTML = `
            <span class="post-number">${post.number}</span>
            <span class="post-name">${post.name}</span>
            <span class="post-date">${post.date}</span>
            <div class="post-content">${post.content}</div>
          `;
          // 掲示板の要素に投稿の要素を追加する
          thread.appendChild(div);
        }
      } catch (error) {
        // エラーが発生したらアラートで表示する
        alert(error.message);
      }
    }

    // ページが読み込まれたときに掲示板を表示する
    window.addEventListener("load", show);

    // 書き込むボタンが押されたときに掲示板に投稿する
    document.getElementById("submit").addEventListener("click", post);
  </script>
</body></html>
