<html>
<head>
  <meta charset="utf-8">
  <title>オンライン掲示板</title>
  <style>
    body {
      background-color: lightblue;
    }
    h1 {
      text-align: center;
    }
    form {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    input, textarea {
      margin: 10px;
    }
    button {
      width: 100px;
      height: 40px;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      border: 1px solid black;
      margin: 10px;
      padding: 10px;
    }
    span {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1 id="title">オンライン掲示板</h1>
  <form id="settings">
    <input type="text" id="board-title" placeholder="掲示板のタイトルを入力してください">
    <input type="color" id="board-color" value="#ADD8E6">
    <button type="submit">設定を変更</button>
  </form>
  <form id="post">
    <input type="text" id="name" placeholder="名前を入力してください">
    <textarea id="message" rows="5" cols="50" placeholder="メッセージを入力してください"></textarea>
    <button type="submit">送信</button>
  </form>
  <ul id="messages"></ul>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
  <script>
    // サーバーとの通信用のソケットを作成
    const socket = io("https://online-board.herokuapp.com/");

    // HTML要素を取得
    const title = document.getElementById("title");
    const boardTitle = document.getElementById("board-title");
    const boardColor = document.getElementById("board-color");
    const settings = document.getElementById("settings");
    const name = document.getElementById("name");
    const message = document.getElementById("message");
    const post = document.getElementById("post");
    const messages = document.getElementById("messages");

    // 設定フォームが送信されたときの処理
    settings.addEventListener("submit", (event) => {
      // デフォルトの動作をキャンセル
      event.preventDefault();
      // サーバーに設定変更を通知
      socket.emit("change settings", {
        title: boardTitle.value,
        color: boardColor.value
      });
      // 入力欄を空にする
      boardTitle.value = "";
      boardColor.value = "#ADD8E6";
    });

    // 投稿フォームが送信されたときの処理
    post.addEventListener("submit", (event) => {
      // デフォルトの動作をキャンセル
      event.preventDefault();
      // サーバーにメッセージ投稿を通知
      socket.emit("post message", {
        name: name.value,
        message: message.value
      });
      // 入力欄を空にする
      name.value = "";
      message.value = "";
    });

    // サーバーから設定変更が通知されたときの処理
    socket.on("change settings", (data) => {
      // 掲示板のタイトルと背景色を変更する
      title.textContent = data.title;
      document.body.style.backgroundColor = data.color;
    });

    // サーバーからメッセージ投稿が通知されたときの処理
    socket.on("post message", (data) => {
      // メッセージを表示するための要素を作成
      const li = document.createElement("li");
      const span = document.createElement("span");
      const p = document.createElement("p");
      const button = document.createElement("button");
      // 要素にデータをセット
      span.textContent = data.name + " (" + data.date + ")";
      p.textContent = data.message;
      button.textContent = "削除";
      // ボタンがクリックされたときの処理
      button.addEventListener("click", () => {
        // サーバーにメッセージ削除を通知
        socket.emit("delete message", data.id);
      });
      // 要素を組み合わせてリストに追加
      li.appendChild(span);
      li.appendChild(p);
      li.appendChild(button);
      messages.appendChild(li);
    });

    // サーバーからメッセージ削除が通知されたときの処理
    socket.on("delete message", (id) => {
      // メッセージの要素を探す
      const li = messages.querySelector(`li[data-id="${id}"]`);
      // メッセージの要素があればリストから削除
      if (li) {
        messages.removeChild(li);
      }
    });
  </script>
</body>
</html>
